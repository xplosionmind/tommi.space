---
permalink: /test/
---
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Pagefind Advanced Example</title>
  <!-- Include Pagefind's default script -->
  <script src="https://unpkg.com/pagefind/dist/pagefind.js" defer></script>
</head>
<body>

  <!-- Search bar for Pagefind -->
  <input
    type="search"
    id="search-input"
    placeholder="Search..."
    aria-label="Search your content"
  />

  <!-- Filter controls -->
  <select id="category-filter" aria-label="Filter by category">
    <option value="">All Categories</option>
    <option value="frontend">Frontend</option>
    <option value="backend">Backend</option>
    <option value="devops">DevOps</option>
  </select>

  <!-- Sort controls -->
  <select id="sort-select" aria-label="Sort by rating">
    <option value="none">No Sort</option>
    <option value="ascending">Sort by Rating (Ascending)</option>
    <option value="descending">Sort by Rating (Descending)</option>
  </select>

  <!-- Content elements: Each item has data attributes for filtering or sorting -->
  <div class="pagefind-content" data-category="frontend" data-rating="3" id="frontend-1">
    <h2>Item A (Frontend)</h2>
    <p>This is some content about frontend development.</p>
  </div>

  <div class="pagefind-content" data-category="backend" data-rating="5" id="backend-1">
    <h2>Item B (Backend)</h2>
    <p>Information about server-side operations.</p>
  </div>

  <div class="pagefind-content" data-category="frontend" data-rating="4" id="frontend-2">
    <h2>Item C (Frontend)</h2>
    <p>Another piece of content related to frontend development.</p>
  </div>

  <div class="pagefind-content" data-category="devops" data-rating="2" id="devops-1">
    <h2>Item D (DevOps)</h2>
    <p>An entry for DevOps processes and tools.</p>
  </div>

  <script>
    // Initialize Pagefind when DOM is ready
    document.addEventListener('DOMContentLoaded', async () => {
      // Load Pagefind index
      // "resetStyles: false" allows you to style the results manually if desired
      const pagefind = await window.pagefind({
        element: '#search-input',
        resetStyles: false
      });

      // Grabbing all pagefind-content items for filtering/sorting
      const items = Array.from(document.querySelectorAll('.pagefind-content'));

      // Get the filtering and sorting elements
      const categoryFilter = document.getElementById('category-filter');
      const sortSelect = document.getElementById('sort-select');
      const searchInput = document.getElementById('search-input');

      /**
       * filterAndSortItems()
       * This function receives an array of search results from Pagefind and
       * applies filtering based on the category dropdown, then sorts
       * the matched items based on the rating data attribute.
       */
      function filterAndSortItems(searchResults) {
        // Search results are either an array of matched page elements or null if no query
        let filteredItems;

        // If there is an active search query and results, filter items by matched IDs
        if (searchResults && searchResults.length > 0) {
          const matchedIDs = new Set(searchResults.map(result => result.id));
          filteredItems = items.filter(item => matchedIDs.has(item.id));
        } else if (searchResults) {
          // If search ran but no results were found, return an empty set
          filteredItems = [];
        } else {
          // If there's no query yet, display all items
          filteredItems = items;
        }

        // Apply category filtering
        const selectedCategory = categoryFilter.value;
        if (selectedCategory) {
          filteredItems = filteredItems.filter(
            item => item.dataset.category === selectedCategory
          );
        }

        // Perform sorting based on rating
        const sortValue = sortSelect.value;
        if (sortValue === 'ascending') {
          filteredItems.sort((a, b) => Number(a.dataset.rating) - Number(b.dataset.rating));
        } else if (sortValue === 'descending') {
          filteredItems.sort((a, b) => Number(b.dataset.rating) - Number(a.dataset.rating));
        }

        // Hide all items, then show only the filtered & sorted items
        items.forEach(item => {
          item.style.display = 'none';
        });
        filteredItems.forEach(item => {
          item.style.display = 'block';
        });
      }

      // Listen for the "pagefind:search" event (triggered after a search update)
      document.addEventListener('pagefind:search', event => {
        // event.detail.results has the array of matching elements
        filterAndSortItems(event.detail.results);
      });

      // Whenever the user changes the category filter, re-run the search
      categoryFilter.addEventListener('change', () => {
        pagefind.triggerSearch(searchInput.value);
      });

      // Whenever the user changes the sort option, re-run the search
      sortSelect.addEventListener('change', () => {
        pagefind.triggerSearch(searchInput.value);
      });
    });
  </script>
</body>
</html>
